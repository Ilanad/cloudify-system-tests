tosca_definitions_version: cloudify_dsl_1_3

imports:
  - http://www.getcloudify.org/spec/cloudify/4.2.dev1/types.yaml


inputs:
  host_ip:
  host_user:
  key_file:
  agent_scale:


node_templates:

  agent_host:
    type: cloudify.nodes.Compute

    properties:
      ip: {get_input: host_ip}
      agent_config:
        key: {get_secret: agent_host_key}
        user: {get_input: host_user}


  fake_node:
    type: cloudify.nodes.Compute

    properties:
      ip: {get_property: [fake_node_host, ip]}
      agent_config:
        key: {get_secret: agent_host_key}
        user: {get_input: host_user}

    capabilities:
      scalable:
        properties:
          default_instances: {get_input: agent_scale}

    relationships:
      - type: cloudify.relationships.contained_in
        target: agent_host
